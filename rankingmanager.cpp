//=============================================================================
//
// ランキングマネージャー処理 [rankingmanager.cpp]
// Author : RIKU TANEKAWA
//
//=============================================================================

//*****************************************************************************
// インクルードファイル
//*****************************************************************************
#include "rankingmanager.h"

//*****************************************************************************
// 静的メンバ変数宣言
//*****************************************************************************
CRankingManager* CRankingManager::m_Instance = nullptr;

//=============================================================================
// コンストラクタ
//=============================================================================
CRankingManager::CRankingManager()
{
    // 初期ランキングを 99:59 で埋めておく
    m_rankList.resize(MAX_RANK);
    for (auto& r : m_rankList)
    {
        r.minutes = 99;
        r.seconds = 59;
    }

    // ランキングの読み込み
	Load();
}
//=============================================================================
// デストラクタ
//=============================================================================
CRankingManager::~CRankingManager()
{
	// なし
}
//=============================================================================
// 保存処理
//=============================================================================
void CRankingManager::Save(void)
{
    // ファイルを開く
    FILE* fp = fopen("data/ranking.txt", "w");

    if (!fp)
    {
        return;
    }

    for (auto& data : m_rankList)
    {
        fprintf(fp, "%d %d %d\n", data.minutes, data.seconds, data.items);
    }

    // ファイルを閉じる
    fclose(fp);
}
//=============================================================================
// 読み込み処理
//=============================================================================
void CRankingManager::Load(void)
{
    m_rankList.clear();

    // ファイルを開く
    FILE* fp = fopen("data/ranking.txt", "r");

    if (!fp)
    {
        return;
    }

    int min, sec, items;

    while (fscanf(fp, "%d %d %d", &min, &sec, &items) == 3)
    {
        RankData data;
        data.minutes = min;
        data.seconds = sec;
        data.items = items;
        m_rankList.push_back(data);
    }

    // ファイルを閉じる
    fclose(fp);
}
